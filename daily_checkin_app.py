
import streamlit as st

# Prebuilt mapping of (habit, score) -> weight
user_defined_weight_mapping = {('Sleep quality', 1): 0.9, ('Sleep quality', 2): 0.93, ('Sleep quality', 3): 0.94, ('Sleep quality', 4): 0.95, ('Sleep quality', 5): 0.97, ('Sleep quality', 6): 0.99, ('Sleep quality', 7): 1.0, ('Sleep quality', 8): 1.03, ('Sleep quality', 9): 1.07, ('Sleep quality', 10): 1.12, ('Sunlight exposure', 1): 0.91, ('Sunlight exposure', 2): 0.93, ('Sunlight exposure', 3): 0.94, ('Sunlight exposure', 4): 0.95, ('Sunlight exposure', 5): 0.97, ('Sunlight exposure', 6): 0.99, ('Sunlight exposure', 7): 1.01, ('Sunlight exposure', 8): 1.03, ('Sunlight exposure', 9): 1.05, ('Sunlight exposure', 10): 1.07, ('Workout intensity', 1): 0.89, ('Workout intensity', 2): 0.91, ('Workout intensity', 3): 0.92, ('Workout intensity', 4): 0.93, ('Workout intensity', 5): 0.96, ('Workout intensity', 6): 0.99, ('Workout intensity', 7): 1.01, ('Workout intensity', 8): 1.03, ('Workout intensity', 9): 1.08, ('Workout intensity', 10): 1.1, ('Step count', 1): 0.9, ('Step count', 2): 0.91, ('Step count', 3): 0.93, ('Step count', 4): 0.95, ('Step count', 5): 0.97, ('Step count', 6): 0.98, ('Step count', 7): 1.0, ('Step count', 8): 1.02, ('Step count', 9): 1.04, ('Step count', 10): 1.05, ('Work focus', 1): 0.92, ('Work focus', 2): 0.93, ('Work focus', 3): 0.94, ('Work focus', 4): 0.96, ('Work focus', 5): 0.98, ('Work focus', 6): 0.99, ('Work focus', 7): 1.01, ('Work focus', 8): 1.02, ('Work focus', 9): 1.03, ('Work focus', 10): 1.04, ('Diet cleanliness', 1): 0.89, ('Diet cleanliness', 2): 0.91, ('Diet cleanliness', 3): 0.92, ('Diet cleanliness', 4): 0.94, ('Diet cleanliness', 5): 0.96, ('Diet cleanliness', 6): 0.98, ('Diet cleanliness', 7): 1.0, ('Diet cleanliness', 8): 1.02, ('Diet cleanliness', 9): 1.04, ('Diet cleanliness', 10): 1.07, ('Vitamin & mineral intake', 1): 0.9, ('Vitamin & mineral intake', 2): 0.91, ('Vitamin & mineral intake', 3): 0.92, ('Vitamin & mineral intake', 4): 0.95, ('Vitamin & mineral intake', 5): 0.96, ('Vitamin & mineral intake', 6): 0.98, ('Vitamin & mineral intake', 7): 1.0, ('Vitamin & mineral intake', 8): 1.02, ('Vitamin & mineral intake', 9): 1.04, ('Vitamin & mineral intake', 10): 1.05, ('Fasting duration', 1): 0.91, ('Fasting duration', 2): 0.92, ('Fasting duration', 3): 0.93, ('Fasting duration', 4): 0.94, ('Fasting duration', 5): 0.96, ('Fasting duration', 6): 0.99, ('Fasting duration', 7): 1.01, ('Fasting duration', 8): 1.02, ('Fasting duration', 9): 1.04, ('Fasting duration', 10): 1.05, ('Water intake', 1): 0.9, ('Water intake', 2): 0.92, ('Water intake', 3): 0.93, ('Water intake', 4): 0.95, ('Water intake', 5): 0.97, ('Water intake', 6): 0.98, ('Water intake', 7): 1.01, ('Water intake', 8): 1.02, ('Water intake', 9): 1.03, ('Water intake', 10): 1.05, ('Competitive male environment', 1): 0.94, ('Competitive male environment', 2): 0.95, ('Competitive male environment', 3): 0.96, ('Competitive male environment', 4): 0.97, ('Competitive male environment', 5): 0.98, ('Competitive male environment', 6): 0.99, ('Competitive male environment', 7): 1.01, ('Competitive male environment', 8): 1.02, ('Competitive male environment', 9): 1.04, ('Competitive male environment', 10): 1.06, ('Breathing style', 1): 0.92, ('Breathing style', 2): 0.94, ('Breathing style', 3): 0.95, ('Breathing style', 4): 0.96, ('Breathing style', 5): 0.97, ('Breathing style', 6): 0.99, ('Breathing style', 7): 1.01, ('Breathing style', 8): 1.03, ('Breathing style', 9): 1.05, ('Breathing style', 10): 1.07, ('Cold exposure', 1): 0.92, ('Cold exposure', 2): 0.93, ('Cold exposure', 3): 0.94, ('Cold exposure', 4): 0.95, ('Cold exposure', 5): 0.97, ('Cold exposure', 6): 0.99, ('Cold exposure', 7): 1.01, ('Cold exposure', 8): 1.02, ('Cold exposure', 9): 1.03, ('Cold exposure', 10): 1.04, ('Stress level', 1): 1.1, ('Stress level', 2): 1.07, ('Stress level', 3): 1.03, ('Stress level', 4): 1.01, ('Stress level', 5): 0.98, ('Stress level', 6): 0.96, ('Stress level', 7): 0.94, ('Stress level', 8): 0.93, ('Stress level', 9): 0.9, ('Stress level', 10): 0.87, ('Sugar intake', 1): 1.09, ('Sugar intake', 2): 1.06, ('Sugar intake', 3): 1.03, ('Sugar intake', 4): 0.99, ('Sugar intake', 5): 0.97, ('Sugar intake', 6): 0.95, ('Sugar intake', 7): 0.94, ('Sugar intake', 8): 0.93, ('Sugar intake', 9): 0.91, ('Sugar intake', 10): 0.87, ('Plastic usage', 1): 1.06, ('Plastic usage', 2): 1.04, ('Plastic usage', 3): 1.02, ('Plastic usage', 4): 1.0, ('Plastic usage', 5): 0.97, ('Plastic usage', 6): 0.95, ('Plastic usage', 7): 0.93, ('Plastic usage', 8): 0.91, ('Plastic usage', 9): 0.9, ('Plastic usage', 10): 0.88, ('Screen time', 1): 1.05, ('Screen time', 2): 1.04, ('Screen time', 3): 1.03, ('Screen time', 4): 1.01, ('Screen time', 5): 0.97, ('Screen time', 6): 0.95, ('Screen time', 7): 0.94, ('Screen time', 8): 0.93, ('Screen time', 9): 0.92, ('Screen time', 10): 0.9, ('Adult content exposure', 1): 1.07, ('Adult content exposure', 2): 1.05, ('Adult content exposure', 3): 1.01, ('Adult content exposure', 4): 0.98, ('Adult content exposure', 5): 0.95, ('Adult content exposure', 6): 0.94, ('Adult content exposure', 7): 0.93, ('Adult content exposure', 8): 0.92, ('Adult content exposure', 9): 0.9, ('Adult content exposure', 10): 0.89, ('Polyester clothing usage', 1): 1.07, ('Polyester clothing usage', 2): 1.05, ('Polyester clothing usage', 3): 1.03, ('Polyester clothing usage', 4): 0.99, ('Polyester clothing usage', 5): 0.98, ('Polyester clothing usage', 6): 0.97, ('Polyester clothing usage', 7): 0.95, ('Polyester clothing usage', 8): 0.93, ('Polyester clothing usage', 9): 0.91, ('Polyester clothing usage', 10): 0.89, ('BPA exposure', 1): 1.04, ('BPA exposure', 2): 1.03, ('BPA exposure', 3): 1.02, ('BPA exposure', 4): 1.0, ('BPA exposure', 5): 0.98, ('BPA exposure', 6): 0.96, ('BPA exposure', 7): 0.95, ('BPA exposure', 8): 0.93, ('BPA exposure', 9): 0.91, ('BPA exposure', 10): 0.9, ('Alcohol consumption', 1): 1.05, ('Alcohol consumption', 2): 1.02, ('Alcohol consumption', 3): 0.99, ('Alcohol consumption', 4): 0.97, ('Alcohol consumption', 5): 0.95, ('Alcohol consumption', 6): 0.94, ('Alcohol consumption', 7): 0.93, ('Alcohol consumption', 8): 0.92, ('Alcohol consumption', 9): 0.91, ('Alcohol consumption', 10): 0.9}

# Ordered habits
habits_in_order = ['Sleep quality', 'Sunlight exposure', 'Workout intensity', 'Step count', 'Work focus', 'Diet cleanliness', 'Vitamin & mineral intake', 'Fasting duration', 'Water intake', 'Competitive male environment', 'Breathing style', 'Cold exposure', 'Stress level', 'Sugar intake', 'Plastic usage', 'Screen time', 'Adult content exposure', 'Polyester clothing usage', 'BPA exposure', 'Alcohol consumption']

def daily_check_in_calculator(current_testosterone, daily_scores):
    if len(daily_scores) != 20:
        raise ValueError("You must provide exactly 20 scores (one per habit).")
    weights_today = []
    for habit, score in zip(habits_in_order, daily_scores):
        weight = user_defined_weight_mapping.get((habit, score), 1.0)
        weights_today.append(weight)
    average_weight = sum(weights_today) / len(weights_today)
    updated_testosterone = current_testosterone * average_weight
    updated_testosterone = max(250, min(1100, round(updated_testosterone)))
    return updated_testosterone

st.title("ðŸ§  Daily Testosterone Check-In Calculator")

st.markdown("""
Enter your current testosterone level and today's habit scores (1â€“10).  
We'll calculate your updated testosterone based on your real habits! ðŸš€
""")

base_testosterone = st.number_input("Enter your current/base testosterone (ng/dL):", min_value=250, max_value=1100, value=700)

st.subheader("Enter today's scores for each habit (1 to 10):")
daily_scores = []

for habit in habits_in_order:
    score = st.slider(habit, min_value=1, max_value=10, value=7)
    daily_scores.append(score)

if st.button("Calculate Updated Testosterone ðŸš€"):
    updated_testosterone = daily_check_in_calculator(base_testosterone, daily_scores)
    st.success(f"âœ… Your updated testosterone level is: {updated_testosterone} ng/dL")
